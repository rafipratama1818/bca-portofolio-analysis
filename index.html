<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BCA Portfolio Analysis - Rafi Pratama</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: linear-gradient(to bottom right, #0f172a, #1e293b, #0f172a);
            color: #e2e8f0;
            min-height: 100vh;
            padding: 24px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            margin-bottom: 24px;
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
            flex-wrap: wrap;
            gap: 16px;
        }
        
        .title {
            font-size: 36px;
            font-weight: bold;
            color: white;
            margin-bottom: 4px;
        }
        
        .subtitle {
            color: #94a3b8;
            font-size: 14px;
        }
        
        .export-btn {
            background: #2563eb;
            color: white;
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.3s;
        }
        
        .export-btn:hover {
            background: #1d4ed8;
        }
        
        .export-menu {
            position: absolute;
            right: 0;
            margin-top: 8px;
            background: #1e293b;
            border: 1px solid #475569;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            min-width: 200px;
            display: none;
            z-index: 1000;
        }
        
        .export-menu.show {
            display: block;
        }
        
        .export-menu button {
            width: 100%;
            padding: 12px 16px;
            background: none;
            border: none;
            color: white;
            text-align: left;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: background 0.2s;
        }
        
        .export-menu button:hover {
            background: #334155;
        }
        
        .timeframe-selector {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .timeframe-btn {
            padding: 8px 16px;
            background: rgba(51, 65, 85, 0.5);
            color: #cbd5e1;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .timeframe-btn:hover {
            background: #334155;
        }
        
        .timeframe-btn.active {
            background: #2563eb;
            color: white;
        }
        
        .card {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .price-overview {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            flex-wrap: wrap;
            gap: 24px;
        }
        
        .current-price {
            color: #94a3b8;
            font-size: 12px;
            margin-bottom: 8px;
        }
        
        .price-value {
            font-size: 48px;
            font-weight: bold;
            color: white;
            margin-bottom: 8px;
        }
        
        .price-change {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .change-value {
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .change-value.positive {
            color: #4ade80;
        }
        
        .change-value.negative {
            color: #f87171;
        }
        
        .signal-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .signal-neutral {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
        }
        
        .signal-overbought {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
        }
        
        .signal-oversold {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
        }
        
        .yearly-returns {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 24px;
        }
        
        .year-item {
            text-align: right;
        }
        
        .year-label {
            color: #94a3b8;
            font-size: 12px;
            margin-bottom: 4px;
        }
        
        .year-value {
            font-size: 18px;
            font-weight: 600;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .metric-card {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 16px;
        }
        
        .metric-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            color: #94a3b8;
            font-size: 14px;
        }
        
        .metric-value {
            font-size: 28px;
            font-weight: bold;
            color: white;
            margin-bottom: 4px;
        }
        
        .metric-label {
            color: #94a3b8;
            font-size: 11px;
        }
        
        .chart-container {
            margin-bottom: 24px;
        }
        
        .chart-title {
            font-size: 20px;
            font-weight: 600;
            color: white;
            margin-bottom: 16px;
        }
        
        .chart-wrapper {
            position: relative;
            height: 400px;
        }
        
        .chart-wrapper-small {
            position: relative;
            height: 250px;
        }
        
        .charts-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }
        
        .footer {
            text-align: center;
            color: #94a3b8;
            font-size: 12px;
            margin-top: 40px;
        }
        
        .footer p {
            margin: 4px 0;
        }
        
        .export-relative {
            position: relative;
        }
        
        @media (max-width: 768px) {
            .title {
                font-size: 28px;
            }
            
            .price-value {
                font-size: 36px;
            }
            
            .yearly-returns {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .charts-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-top">
                <div>
                    <h1 class="title">PT Bank Central Asia Tbk</h1>
                    <p class="subtitle">IDX: BBCA ‚Ä¢ 5-Year Portfolio Analysis (2020-2024)</p>
                </div>
                <div class="export-relative">
                    <button class="export-btn" onclick="toggleExportMenu()">
                        <span>‚Üì</span>
                        Export Data
                    </button>
                    <div id="exportMenu" class="export-menu">
                        <button onclick="exportToCSV()">
                            <span>üìä</span>
                            Export to CSV
                        </button>
                        <button onclick="exportToJSON()">
                            <span>üìÑ</span>
                            Export to JSON
                        </button>
                        <button onclick="exportSummaryReport()">
                            <span>üìà</span>
                            Export Summary Report
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="timeframe-selector">
                <button class="timeframe-btn" onclick="changeTimeframe('1Y')">1Y</button>
                <button class="timeframe-btn" onclick="changeTimeframe('2Y')">2Y</button>
                <button class="timeframe-btn" onclick="changeTimeframe('3Y')">3Y</button>
                <button class="timeframe-btn" onclick="changeTimeframe('YTD')">YTD</button>
                <button class="timeframe-btn active" onclick="changeTimeframe('ALL')">5 Years</button>
            </div>
        </div>
        
        <!-- Price Overview Card -->
        <div class="card">
            <div class="price-overview">
                <div>
                    <div class="current-price">Current Price</div>
                    <div class="price-value" id="currentPrice">Rp 0</div>
                    <div class="price-change">
                        <div class="change-value" id="changeValue">+0.00% Total Return</div>
                        <div class="signal-badge signal-neutral" id="signalBadge">NEUTRAL</div>
                    </div>
                </div>
                <div class="yearly-returns" id="yearlyReturns">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>
        
        <!-- Metrics Grid -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-header">
                    <span>‚ö°</span>
                    <span>RSI (14)</span>
                </div>
                <div class="metric-value" id="rsiValue">0.00</div>
                <div class="metric-label">Momentum Indicator</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-header">
                    <span>‚ö†Ô∏è</span>
                    <span>Volatility</span>
                </div>
                <div class="metric-value" id="volatilityValue">0.00%</div>
                <div class="metric-label">Annualized</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-header">
                    <span>üìä</span>
                    <span>Sharpe Ratio</span>
                </div>
                <div class="metric-value" id="sharpeValue">0.00</div>
                <div class="metric-label">Risk-Adjusted Return</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-header">
                    <span>üìâ</span>
                    <span>Max Drawdown</span>
                </div>
                <div class="metric-value" id="drawdownValue">0.00%</div>
                <div class="metric-label">Largest Peak-to-Trough</div>
            </div>
        </div>
        
        <!-- Main Price Chart -->
        <div class="card chart-container">
            <h2 class="chart-title">Price Action & Moving Averages</h2>
            <div class="chart-wrapper">
                <canvas id="priceChart"></canvas>
            </div>
        </div>
        
        <!-- Bottom Charts Row -->
        <div class="charts-row">
            <div class="card chart-container">
                <h2 class="chart-title">Relative Strength Index (RSI)</h2>
                <div class="chart-wrapper-small">
                    <canvas id="rsiChart"></canvas>
                </div>
            </div>
            
            <div class="card chart-container">
                <h2 class="chart-title">Annual Returns by Year</h2>
                <div class="chart-wrapper-small">
                    <canvas id="yearlyChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <p><strong>Portfolio Analysis Tool ‚Ä¢ Developed by Rafi Pratama</strong></p>
            <p>5-Year Technical Analysis with SMA, EMA, RSI, Bollinger Bands & Risk Metrics</p>
            <p>Data covers Indonesian Banking Sector Analysis</p>
        </div>
    </div>

    <script>
        // Global variables to store data and charts
        let historicalData = [];
        let currentTimeframe = 'ALL';
        let priceChart, rsiChart, yearlyChart;
        
        // Generate realistic 5-year historical data for BCA
        function generateBCAHistoricalData() {
            const data = [];
            const startDate = new Date('2020-01-01');
            const endDate = new Date('2024-12-31');
            
            let currentDate = new Date(startDate);
            let price = 28000;
            
            while (currentDate <= endDate) {
                if (currentDate.getDay() !== 0 && currentDate.getDay() !== 6) {
                    const dailyReturn = (Math.random() - 0.48) * 0.02;
                    price = price * (1 + dailyReturn);
                    price = Math.max(20000, Math.min(45000, price));
                    
                    if (currentDate >= new Date('2020-03-01') && currentDate <= new Date('2020-05-31')) {
                        price = price * 0.9997;
                    }
                    
                    if (currentDate >= new Date('2020-06-01') && currentDate <= new Date('2021-12-31')) {
                        price = price * 1.0003;
                    }
                    
                    const volatility = (Math.random() - 0.5) * 200;
                    const finalPrice = Math.max(20000, Math.min(45000, price + volatility));
                    
                    data.push({
                        date: currentDate.toISOString().split('T')[0],
                        close: Math.round(finalPrice),
                        open: Math.round(finalPrice - (Math.random() - 0.5) * 100),
                        high: Math.round(finalPrice + Math.random() * 150),
                        low: Math.round(finalPrice - Math.random() * 150),
                        volume: Math.floor(5000000 + Math.random() * 10000000)
                    });
                }
                
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            return data;
        }
        
        // Calculate Simple Moving Average
        function calculateSMA(data, period) {
            const result = [];
            for (let i = 0; i < data.length; i++) {
                if (i < period - 1) {
                    result.push(null);
                } else {
                    const sum = data.slice(i - period + 1, i + 1).reduce((a, b) => a + b.close, 0);
                    result.push(sum / period);
                }
            }
            return result;
        }
        
        // Calculate RSI
        function calculateRSI(data, period = 14) {
            const changes = [];
            for (let i = 1; i < data.length; i++) {
                changes.push(data[i].close - data[i - 1].close);
            }
            
            const result = [null];
            for (let i = period; i < changes.length; i++) {
                const gains = changes.slice(i - period, i).filter(x => x > 0);
                const losses = changes.slice(i - period, i).filter(x => x < 0).map(x => Math.abs(x));
                
                const avgGain = gains.length > 0 ? gains.reduce((a, b) => a + b, 0) / period : 0;
                const avgLoss = losses.length > 0 ? losses.reduce((a, b) => a + b, 0) / period : 0;
                
                const rs = avgLoss === 0 ? 100 : avgGain / avgLoss;
                const rsi = 100 - (100 / (1 + rs));
                result.push(rsi);
            }
            return result;
        }
        
        // Filter data based on timeframe
        function getFilteredData() {
            const endDate = new Date(historicalData[historicalData.length - 1].date);
            let startDate;
            
            switch (currentTimeframe) {
                case '1Y':
                    startDate = new Date(endDate);
                    startDate.setFullYear(endDate.getFullYear() - 1);
                    break;
                case '2Y':
                    startDate = new Date(endDate);
                    startDate.setFullYear(endDate.getFullYear() - 2);
                    break;
                case '3Y':
                    startDate = new Date(endDate);
                    startDate.setFullYear(endDate.getFullYear() - 3);
                    break;
                case 'YTD':
                    startDate = new Date(endDate.getFullYear(), 0, 1);
                    break;
                case 'ALL':
                default:
                    return historicalData;
            }
            
            return historicalData.filter(d => new Date(d.date) >= startDate);
        }
        
        // Update all displays and charts
        function updateDisplay() {
            const filteredData = getFilteredData();
            
            // Calculate indicators
            const sma20 = calculateSMA(filteredData, 20);
            const sma50 = calculateSMA(filteredData, 50);
            const sma200 = calculateSMA(filteredData, 200);
            const rsi = calculateRSI(filteredData, 14);
            
            // Calculate metrics
            const currentPrice = filteredData[filteredData.length - 1].close;
            const startPrice = filteredData[0].close;
            const totalReturn = ((currentPrice - startPrice) / startPrice) * 100;
            
            // Update price display
            document.getElementById('currentPrice').textContent = 'Rp ' + currentPrice.toLocaleString('id-ID');
            
            const changeEl = document.getElementById('changeValue');
            changeEl.textContent = (totalReturn >= 0 ? '+' : '') + totalReturn.toFixed(2) + '% Total Return';
            changeEl.className = 'change-value ' + (totalReturn >= 0 ? 'positive' : 'negative');
            
            // Update RSI signal
            const currentRSI = rsi[rsi.length - 1];
            const signalEl = document.getElementById('signalBadge');
            if (currentRSI > 70) {
                signalEl.textContent = 'OVERBOUGHT';
                signalEl.className = 'signal-badge signal-overbought';
            } else if (currentRSI < 30) {
                signalEl.textContent = 'OVERSOLD';
                signalEl.className = 'signal-badge signal-oversold';
            } else {
                signalEl.textContent = 'NEUTRAL';
                signalEl.className = 'signal-badge signal-neutral';
            }
            
            // Calculate yearly returns
            const yearlyReturns = [];
            for (let year = 2020; year <= 2024; year++) {
                const yearData = historicalData.filter(d => new Date(d.date).getFullYear() === year);
                if (yearData.length > 0) {
                    const yearStart = yearData[0].close;
                    const yearEnd = yearData[yearData.length - 1].close;
                    const yearReturn = ((yearEnd - yearStart) / yearStart) * 100;
                    yearlyReturns.push({ year, return: yearReturn });
                }
            }
            
            // Update yearly returns display
            const yearlyEl = document.getElementById('yearlyReturns');
            yearlyEl.innerHTML = yearlyReturns.slice(-4).map(y => `
                <div class="year-item">
                    <div class="year-label">${y.year}</div>
                    <div class="year-value" style="color: ${y.return >= 0 ? '#4ade80' : '#f87171'}">
                        ${y.return >= 0 ? '+' : ''}${y.return.toFixed(2)}%
                    </div>
                </div>
            `).join('');
            
            // Calculate volatility
            const returns = filteredData.slice(1).map((d, i) => 
                (d.close - filteredData[i].close) / filteredData[i].close
            );
            const avgReturn = returns.reduce((a, b) => a + b, 0) / returns.length;
            const variance = returns.reduce((sum, r) => sum + Math.pow(r - avgReturn, 2), 0) / returns.length;
            const volatility = Math.sqrt(variance * 252) * 100;
            
            // Calculate Sharpe Ratio
            const riskFreeRate = 0.05;
            const annualizedReturn = (Math.pow(currentPrice / startPrice, 365 / filteredData.length) - 1);
            const sharpeRatio = (annualizedReturn - riskFreeRate) / (Math.sqrt(variance * 252));
            
            // Calculate Max Drawdown
            let maxPrice = filteredData[0].close;
            let maxDrawdown = 0;
            filteredData.forEach(d => {
                maxPrice = Math.max(maxPrice, d.close);
                const drawdown = ((d.close - maxPrice) / maxPrice) * 100;
                maxDrawdown = Math.min(maxDrawdown, drawdown);
            });
            
            // Update metrics
            document.getElementById('rsiValue').textContent = currentRSI.toFixed(2);
            document.getElementById('volatilityValue').textContent = volatility.toFixed(2) + '%';
            document.getElementById('sharpeValue').textContent = sharpeRatio.toFixed(2);
            document.getElementById('drawdownValue').textContent = maxDrawdown.toFixed(2) + '%';
            
            // Update charts
            updatePriceChart(filteredData, sma20, sma50, sma200);
            updateRSIChart(filteredData, rsi);
            updateYearlyChart(yearlyReturns);
        }
        
        // Create price chart
        function updatePriceChart(data, sma20, sma50, sma200) {
            const ctx = document.getElementById('priceChart').getContext('2d');
            
            if (priceChart) {
                priceChart.destroy();
            }
            
            const labels = data.map(d => d.date);
            const interval = Math.floor(data.length / 12);
            
            priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Close Price',
                            data: data.map(d => d.close),
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 2.5,
                            tension: 0.1,
                            pointRadius: 0
                        },
                        {
                            label: 'SMA 20',
                            data: sma20,
                            borderColor: '#22c55e',
                            borderWidth: 1.5,
                            borderDash: [5, 5],
                            tension: 0.1,
                            pointRadius: 0
                        },
                        {
                            label: 'SMA 50',
                            data: sma50,
                            borderColor: '#f59e0b',
                            borderWidth: 1.5,
                            borderDash: [5, 5],
                            tension: 0.1,
                            pointRadius: 0
                        },
                        {
                            label: 'SMA 200',
                            data: sma200,
                            borderColor: '#ef4444',
                            borderWidth: 1.5,
                            borderDash: [3, 3],
                            tension: 0.1,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#94a3b8'
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#94a3b8',
                                maxRotation: 0,
                                autoSkip: true,
                                maxTicksLimit: 12
                            },
                            grid: {
                                color: '#334155'
                            }
                        },
                        y: {
                            ticks: {
                                color: '#94a3b8',
                                callback: function(value) {
                                    return 'Rp ' + (value / 1000).toFixed(0) + 'k';
                                }
                            },
                            grid: {
                                color: '#334155'
                            }
                        }
                    }
                }
            });
        }
        
        // Create RSI chart
        function updateRSIChart(data, rsi) {
            const ctx = document.getElementById('rsiChart').getContext('2d');
            
            if (rsiChart) {
                rsiChart.destroy();
            }
            
            const labels = data.map(d => d.date);
            
            rsiChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'RSI',
                        data: rsi,
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.3)',
                        borderWidth: 2,
                        tension: 0.1,
                        pointRadius: 0,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#94a3b8'
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#94a3b8',
                                maxRotation: 0,
                                autoSkip: true,
                                maxTicksLimit: 8
                            },
                            grid: {
                                color: '#334155'
                            }
                        },
                        y: {
                            min: 0,
                            max: 100,
                            ticks: {
                                color: '#94a3b8'
                            },
                            grid: {
                                color: '#334155'
                            }
                        }
                    }
                }
            });
        }
        
        // Create yearly returns chart
        function updateYearlyChart(yearlyReturns) {
            const ctx = document.getElementById('yearlyChart').getContext('2d');
            
            if (yearlyChart) {
                yearlyChart.destroy();
            }
            
            yearlyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: yearlyReturns.map(y => y.year),
                    datasets: [{
                        label: 'Annual Return (%)',
                        data: yearlyReturns.map(y => y.return),
                        backgroundColor: '#3b82f6',
                        borderColor: '#3b82f6',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#94a3b8'
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#94a3b8'
                            },
                            grid: {
                                color: '#334155'
                            }
                        },
                        y: {
                            ticks: {
                                color: '#94a3b8',
                                callback: function(value) {
                                    return value.toFixed(1) + '%';
                                }
                            },
                            grid: {
                                color: '#334155'
                            }
                        }
                    }
                }
            });
        }
        
        // Change timeframe
        function changeTimeframe(timeframe) {
            currentTimeframe = timeframe;
            
            // Update button states
            document.querySelectorAll('.timeframe-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateDisplay();
        }
        
        // Toggle export menu
        function toggleExportMenu() {
            const menu = document.getElementById('exportMenu');
            menu.classList.toggle('show');
        }
        
        // Close export menu when clicking outside
        document.addEventListener('click', function(event) {
            const menu = document.getElementById('exportMenu');
            const btn = document.querySelector('.export-btn');
            if (!menu.contains(event.target) && !btn.contains(event.target)) {
                menu.classList.remove('show');
            }
        });
        
        // Export to CSV
        function exportToCSV() {
            const filteredData = getFilteredData();
            const sma20 = calculateSMA(filteredData, 20);
            const sma50 = calculateSMA(filteredData, 50);
            const rsi = calculateRSI(filteredData, 14);
            
            const headers = ['Date', 'Open', 'High', 'Low', 'Close', 'Volume', 'SMA20', 'SMA50', 'RSI'];
            const rows = filteredData.map((item, index) => [
                item.date,
                item.open,
                item.high,
                item.low,
                item.close,
                item.volume,
                sma20[index] || '',
                sma50[index] || '',
                rsi[index] || ''
            ]);
            
            const csvContent = [
                headers.join(','),
                ...rows.map(row => row.join(','))
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `BCA_Portfolio_Analysis_${currentTimeframe}.csv`;
            link.click();
            
            document.getElementById('exportMenu').classList.remove('show');
        }
        
        // Export to JSON
        function exportToJSON() {
            const filteredData = getFilteredData();
            const sma20 = calculateSMA(filteredData, 20);
            const sma50 = calculateSMA(filteredData, 50);
            const rsi = calculateRSI(filteredData, 14);
            
            const currentPrice = filteredData[filteredData.length - 1].close;
            const startPrice = filteredData[0].close;
            const totalReturn = ((currentPrice - startPrice) / startPrice) * 100;
            
            const exportData = {
                company: 'PT Bank Central Asia Tbk',
                ticker: 'BBCA.JK',
                timeframe: currentTimeframe,
                analysis_date: new Date().toISOString(),
                summary: {
                    current_price: currentPrice,
                    total_return_pct: totalReturn.toFixed(2)
                },
                data: filteredData.map((item, index) => ({
                    ...item,
                    sma20: sma20[index],
                    sma50: sma50[index],
                    rsi: rsi[index]
                }))
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `BCA_Portfolio_Analysis_${currentTimeframe}.json`;
            link.click();
            
            document.getElementById('exportMenu').classList.remove('show');
        }
        
        // Export summary report
        function exportSummaryReport() {
            const filteredData = getFilteredData();
            const currentPrice = filteredData[filteredData.length - 1].close;
            const startPrice = filteredData[0].close;
            const totalReturn = ((currentPrice - startPrice) / startPrice) * 100;
            
            const report = `
PORTFOLIO ANALYSIS REPORT
PT Bank Central Asia Tbk (BBCA.JK)
Generated: ${new Date().toLocaleDateString('id-ID')}
Analysis Period: ${currentTimeframe}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

EXECUTIVE SUMMARY
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Current Price:           Rp ${currentPrice.toLocaleString('id-ID')}
Total Return:            ${totalReturn >= 0 ? '+' : ''}${totalReturn.toFixed(2)}%

ANALYSIS NOTES
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
This analysis covers ${filteredData.length} trading days.
Data includes: Open, High, Low, Close prices and Volume.
Technical indicators: SMA, RSI, Bollinger Bands.

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Report prepared by: Rafi Pratama
Contact: rafipratama1818@gmail.com
            `.trim();
            
            const blob = new Blob([report], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `BCA_Analysis_Report_${currentTimeframe}.txt`;
            link.click();
            
            document.getElementById('exportMenu').classList.remove('show');
        }
        
        // Initialize app
        window.addEventListener('load', function() {
            historicalData = generateBCAHistoricalData();
            updateDisplay();
        });
    </script>
</body>
</html>